# Полнофункциональное приложение для отслеживания займов

## Онлайн демо

- [Vercel App](https://andynullwong-gl-frontend.vercel.app/)

## Установка

Чтобы запустить этот проект локально, выполните следующие шаги:

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/andynullwong/loan-tracker-fullstack.git
   ```

2. Установите зависимости:

   ```bash
   pnpm install
   ```

3. Запустите сервер разработки:

   ```bash
   pnpm run dev
   ```

## Основные функции

- [**Создать пользователя:**](src/app/users/create/page.tsx) Пользователи могут создать учетную запись для доступа к приложению.
- [**Создать займ:**](src/app/loans/create/page.tsx) Пользователи могут создать новый займ, указав начальный основной баланс, процентную ставку и срок амортизации.
- [**Получить все займы пользователя:**](src/app/users/page.tsx) Пользователи могут просмотреть список всех своих сохраненных займов.
- [**Получить срок амортизации займа:**](src/app/loans/[loanId]/page.tsx) Пользователи могут получить график амортизации для конкретного займа.
- [**Предоставить займ другому пользователю:**](src/app/loans/[loanId]/share/page.tsx) Пользователи могут предоставить детали своего займа другим пользователям.
- [**Управление текущим состоянием пользователя:**](src/context/user.context.tsx) Пользователи могут переключаться между профилями (ID пользователей) для выполнения операций с займами, к которым у конкретных пользователей есть доступ.

## Дополнительные функции

- [**Редактировать детали займа:**](src/app/loans/[loanId]/update/page.tsx) Не было указано в критериях оценки, но было хорошо задокументировано. Была обнаружена небольшая ошибка в этом эндпоинте, которую я устранил с помощью валидации формы. Документировано в `API Bug 1`
- [**Валидация формы:**](src/utils/formValidation.ts) Уведомляет конечных пользователей, когда ввод не соответствует указанному правилу (правилам) и возвращает сообщение об ошибке.
- **Правильная обработка ошибок:** Все асинхронные функции имеют обработку ошибок и будут показывать [всплывающее сообщение об ошибке](src/components/SelectDropdown.tsx#L53), отображать сообщение об ошибке в компоненте [ErrorMessage](src/components/ErrorMessage.tsx) или предоставлять минимум `console.error`.
- **Хороший стиль:** Использована библиотека компонентов Ant Design для более быстрой разработки. Для долгосрочных проектов мое предпочтение - либо TailwindCSS, либо, как минимум, Material UI.
- [**Тестирование состояния и компонентов:**](src/__tests__) Включена поддержка Jest & React Testing Library в приложение и добавлено тестирование ключевых React компонентов, которые зависят от состояния.

## Используемые технологии

- **React**: JavaScript библиотека для создания пользовательских интерфейсов.
- **Next.js**: Фреймворк для веб-приложений.
- **Ant Design**: Библиотека компонентов React UI.
- **Jest & React Testing Library**: Для простого snapshot тестирования React компонентов.

## Решения по дизайну

- Файл `.env`, содержащий URL внешнего API, включен в корень проекта строго для удобства и в противном случае никогда не должен быть включен в репозиторий. Я решил использовать [API Routes](src/app/api) в качестве простого прокси API по нескольким причинам:

  1.  Поскольку API является полуприватным и не защищен ключом API, API routes будут скрывать хост API.
  2.  Без видимости того, как внешний API будет обрабатывать fetch запросы на стороне клиента, я хотел снизить риск непредвиденных проблем, таких как ошибки CORS.
  3.  Масштабируемость: Хотя это всего лишь оценка фронтенда, любое приложение, которое полагается на области видимости пользователей/разрешения и другие сервисы, будет работать с чувствительными или все более сложными данными. Введение API route сейчас позволит добавить дополнительную бизнес-логику или функции middleware без загромождения компонентов фронтенда.

## Обнаруженные ошибки / Обратная связь

- API Bug 1: При редактировании существующего займа назначение `Owner ID`, который отличается от текущего `User ID`, не вызывает ошибку на стороне API и вместо этого ведет себя так, как будто я только что предоставил займ новому владельцу. Эта проблема предотвращается на фронтенде с помощью валидации форм.
- API Bug 2: Связь `Один-ко-многим` или `Многие-ко-многим` между `User` и `Loan` не принудительна на уровне базы данных. Мне удалось вставить недопустимые ID пользователей, такие как `0` или `999`. Этот риск снижается на фронтенде с помощью валидации форм или ограничения опций до действительных пользователей с помощью компонента [`SelectDropdown`](src/components/SelectDropdown.tsx) всех пользователей.
- Документация: `POST: /loans/{loan_id}/share` указывает, что ответ `200` имеет тип `string`, в то время как API фактически возвращает `[string]`. Пока я предотвратил эту проблему, проверяя значение 0-го элемента в [`SelectDropdown` L51](src/components/SelectDropdown.tsx#L51)
- Документация: `LoanSchemaBase.status` указан как `string`, но должен быть более точно описан как `enum` из `active` и `inactive`. Я обнаружил это только при тестировании недопустимых входных данных.
